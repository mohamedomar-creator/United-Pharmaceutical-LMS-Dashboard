<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>United Pharmaceutical - LMS Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004080 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #0066cc, #004080);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.9;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 5px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .stat-card .icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .stat-card.completed { border-left-color: #28a745; }
        .stat-card.completed .icon { color: #28a745; }
        
        .stat-card.progress { border-left-color: #ffc107; }
        .stat-card.progress .icon { color: #ffc107; }
        
        .stat-card.pending { border-left-color: #dc3545; }
        .stat-card.pending .icon { color: #dc3545; }
        
        .stat-card.average { border-left-color: #17a2b8; }
        .stat-card.average .icon { color: #17a2b8; }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .stat-card .label {
            color: #666;
            font-size: 1.1em;
            font-weight: 600;
        }

        .filters-section {
            padding: 30px;
            background: white;
            border-bottom: 2px solid #f0f0f0;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .search-input, .filter-select, .date-input {
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .search-input:focus, .filter-select:focus, .date-input:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .multi-select {
            position: relative;
        }

        .multi-select-trigger {
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .multi-select-trigger:hover {
            border-color: #0066cc;
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #ddd;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .multi-select-dropdown.show {
            display: block;
        }

        .multi-select-option {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .multi-select-option:hover {
            background: #f8f9fa;
        }

        .multi-select-option input[type="checkbox"] {
            margin: 0;
            cursor: pointer;
        }

        .selected-items {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }

        .selected-item {
            background: #0066cc;
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .remove-item {
            cursor: pointer;
            font-weight: bold;
        }

        .chart-container {
            padding: 30px;
            background: white;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-wrapper {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }

        .chart-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .table-container {
            padding: 30px;
            background: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        th {
            background: linear-gradient(45deg, #0066cc, #004080);
            color: white;
            padding: 15px 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        td {
            padding: 15px 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s ease;
        }

        tr:hover td {
            background-color: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }

        .status-progress {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-pending {
            background-color: #f8d7da;
            color: #721c24;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 18px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #0066cc;
            color: white;
        }

        .btn-primary:hover {
            background: #0052a3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) {
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-container {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>United Pharmaceutical</h1>
            <p>Learning Management System - Course Completion Rates</p>
        </div>

        <div class="stats-container">
            <div class="stat-card completed">
                <span class="icon">✓</span>
                <div class="number" id="completedCount">0</div>
                <div class="label">Completed</div>
            </div>
            <div class="stat-card progress">
                <span class="icon">⟳</span>
                <div class="number" id="progressCount">0</div>
                <div class="label">In Progress</div>
            </div>
            <div class="stat-card pending">
                <span class="icon">⏸</span>
                <div class="number" id="pendingCount">0</div>
                <div class="label">Pending</div>
            </div>
            <div class="stat-card average">
                <span class="icon">📊</span>
                <div class="number" id="averageRate">0%</div>
                <div class="label">Average Rate</div>
            </div>
        </div>

        <div class="filters-section">
            <h3 style="margin-bottom: 20px; color: #333;">Filters & Search</h3>
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Search Pharmacists</label>
                    <input type="text" class="search-input" id="pharmacistSearch" placeholder="Search by pharmacist name...">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Filter by Status</label>
                    <select class="filter-select" id="statusFilter">
                        <option value="">All Statuses</option>
                        <option value="Completed">Completed</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Pending">Pending</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">From Date</label>
                    <input type="date" class="date-input" id="dateFrom">
                </div>

                <div class="filter-group">
                    <label class="filter-label">To Date</label>
                    <input type="date" class="date-input" id="dateTo">
                </div>

                <div class="filter-group">
                    <label class="filter-label">Cities (Multi-Select)</label>
                    <div class="multi-select" id="cityMultiSelect">
                        <div class="multi-select-trigger" id="cityTrigger">
                            <span>Select Cities...</span>
                            <span>▼</span>
                        </div>
                        <div class="multi-select-dropdown" id="cityDropdown"></div>
                        <div class="selected-items" id="selectedCities"></div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Supervisors (Multi-Select)</label>
                    <div class="multi-select" id="supervisorMultiSelect">
                        <div class="multi-select-trigger" id="supervisorTrigger">
                            <span>Select Supervisors...</span>
                            <span>▼</span>
                        </div>
                        <div class="multi-select-dropdown" id="supervisorDropdown"></div>
                        <div class="selected-items" id="selectedSupervisors"></div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Districts (Multi-Select)</label>
                    <div class="multi-select" id="districtMultiSelect">
                        <div class="multi-select-trigger" id="districtTrigger">
                            <span>Select Districts...</span>
                            <span>▼</span>
                        </div>
                        <div class="multi-select-dropdown" id="districtDropdown"></div>
                        <div class="selected-items" id="selectedDistricts"></div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Courses (Multi-Select)</label>
                    <div class="multi-select" id="courseMultiSelect">
                        <div class="multi-select-trigger" id="courseTrigger">
                            <span>Select Courses...</span>
                            <span>▼</span>
                        </div>
                        <div class="multi-select-dropdown" id="courseDropdown"></div>
                        <div class="selected-items" id="selectedCourses"></div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Course Type</label>
                    <select class="filter-select" id="courseTypeFilter">
                        <option value="">All Types</option>
                        <option value="Mandatory">Mandatory</option>
                        <option value="Optional">Optional</option>
                    </select>
                </div>

                <div class="filter-group" style="align-self: end;">
                    <button class="btn btn-secondary" id="clearFilters">Clear Filters</button>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-wrapper">
                <h3 class="chart-title">Performance Trend Over Time</h3>
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>

            <div class="charts-grid">
                <div class="chart-wrapper">
                    <h3 class="chart-title">Cities Comparison - Completion Rate</h3>
                    <canvas id="citiesChart" width="400" height="300"></canvas>
                </div>

                <div class="chart-wrapper">
                    <h3 class="chart-title">Supervisors Comparison - Completion Rate</h3>
                    <canvas id="supervisorsChart" width="400" height="300"></canvas>
                </div>

                <div class="chart-wrapper">
                    <h3 class="chart-title">Districts Comparison - Completion Rate</h3>
                    <canvas id="districtsChart" width="400" height="300"></canvas>
                </div>

                <div class="chart-wrapper">
                    <h3 class="chart-title">Courses Comparison - Completion Rate</h3>
                    <canvas id="coursesChart" width="400" height="300"></canvas>
                </div>

                <div class="chart-wrapper">
                    <h3 class="chart-title">Course Types - Performance</h3>
                    <canvas id="courseTypesChart" width="400" height="300"></canvas>
                </div>

                <div class="chart-wrapper">
                    <h3 class="chart-title">Top Pharmacists - Completion Rate</h3>
                    <canvas id="pharmacistsChart" width="400" height="300"></canvas>
                </div>
            </div>

            <div class="chart-wrapper" style="margin-top: 30px;">
                <h3 class="chart-title">Status Distribution</h3>
                <div style="max-width: 400px; margin: 0 auto;">
                    <canvas id="statusPieChart" width="400" height="400"></canvas>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #333; margin: 0;">Pharmacists Data</h3>
                <button class="btn btn-primary" id="toggleTableBtn">Hide Table</button>
            </div>

            <div id="loadingMessage" class="loading">
                Loading data...
            </div>

            <div id="tableSection">
                <table id="dataTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Pharmacist Name</th>
                            <th>City</th>
                            <th>District</th>
                            <th>Supervisor</th>
                            <th>Course</th>
                            <th>Course Type</th>
                            <th>Completion Rate</th>
                            <th>Status</th>
                            <th>Date Completed</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Pharmacists data in Saudi Arabia
        const pharmacistsData = [
            {
                name: "Ahmed Mohammed Al-Otaibi",
                city: "Riyadh",
                district: "King Fahd District",
                supervisor: "Dr. Sarah Abdullah",
                course: "Clinical Pharmacy Basics",
                courseType: "Mandatory",
                completion: 95,
                status: "Completed",
                dateCompleted: "2024-09-15"
            },
            {
                name: "Fatima Ali Al-Qahtani",
                city: "Jeddah",
                district: "Al-Balad",
                supervisor: "Dr. Mohammed Hassan",
                course: "Drug Interactions",
                courseType: "Optional",
                completion: 78,
                status: "In Progress",
                dateCompleted: "2024-09-20"
            },
            {
                name: "Mohammed Abdullah Al-Shammari",
                city: "Dammam",
                district: "Al-Khobar",
                supervisor: "Dr. Nadia Mohammed",
                course: "Patient Safety",
                courseType: "Mandatory",
                completion: 45,
                status: "Pending",
                dateCompleted: "2024-09-18"
            },
            {
                name: "Nour Al-Din Ahmed Al-Ghamdi",
                city: "Riyadh",
                district: "Olaya",
                supervisor: "Dr. Sarah Abdullah",
                course: "Clinical Pharmacy Basics",
                courseType: "Mandatory",
                completion: 100,
                status: "Completed",
                dateCompleted: "2024-09-12"
            },
            {
                name: "Layla Hassan Al-Malki",
                city: "Mecca",
                district: "Al-Aziziyah",
                supervisor: "Dr. Ahmed Salem",
                course: "Pharmaceutical Care",
                courseType: "Optional",
                completion: 62,
                status: "In Progress",
                dateCompleted: "2024-09-22"
            },
            {
                name: "Omar Saad Al-Harbi",
                city: "Taif",
                district: "Shahar",
                supervisor: "Dr. Nadia Mohammed",
                course: "Drug Interactions",
                courseType: "Optional",
                completion: 30,
                status: "Pending",
                dateCompleted: "2024-09-19"
            },
            {
                name: "Khalid Fahd Al-Saud",
                city: "Jeddah",
                district: "Al-Rawdah",
                supervisor: "Dr. Mohammed Hassan",
                course: "Patient Safety",
                courseType: "Mandatory",
                completion: 88,
                status: "Completed",
                dateCompleted: "2024-09-14"
            },
            {
                name: "Abeer Salman Al-Dosari",
                city: "Al-Kharj",
                district: "City Center",
                supervisor: "Dr. Sarah Abdullah",
                course: "Pharmaceutical Care",
                courseType: "Optional",
                completion: 72,
                status: "In Progress",
                dateCompleted: "2024-09-21"
            },
            {
                name: "Youssef Ibrahim Al-Nuaimi",
                city: "Abha",
                district: "Al-Manasek",
                supervisor: "Dr. Khalid Omar",
                course: "Clinical Pharmacy Basics",
                courseType: "Mandatory",
                completion: 91,
                status: "Completed",
                dateCompleted: "2024-09-16"
            },
            {
                name: "Rana Meshal Al-Anzi",
                city: "Tabuk",
                district: "Al-Rawdah",
                supervisor: "Dr. Fahd Rashid",
                course: "Advanced Therapeutics",
                courseType: "Optional",
                completion: 55,
                status: "In Progress",
                dateCompleted: "2024-09-23"
            },
            {
                name: "Abdullah Saeed Al-Zahrani",
                city: "Medina",
                district: "Al-Haram",
                supervisor: "Dr. Ahmed Salem",
                course: "Patient Safety",
                courseType: "Mandatory",
                completion: 82,
                status: "Completed",
                dateCompleted: "2024-09-17"
            },
            {
                name: "Maryam Faisal Al-Rashid",
                city: "Khobar",
                district: "Corniche",
                supervisor: "Dr. Nadia Mohammed",
                course: "Advanced Therapeutics",
                courseType: "Optional",
                completion: 67,
                status: "In Progress",
                dateCompleted: "2024-09-24"
            }
        ];

        let filteredData = [...pharmacistsData];
        let selectedCities = [];
        let selectedSupervisors = [];
        let selectedDistricts = [];
        let selectedCourses = [];
        let charts = {};

        // Update statistics
        function updateStats() {
            const completed = filteredData.filter(p => p.status === 'Completed').length;
            const progress = filteredData.filter(p => p.status === 'In Progress').length;
            const pending = filteredData.filter(p => p.status === 'Pending').length;
            const averageCompletion = Math.round(
                filteredData.reduce((sum, p) => sum + p.completion, 0) / filteredData.length
            ) || 0;
            
            animateCounter('completedCount', completed);
            animateCounter('progressCount', progress);
            animateCounter('pendingCount', pending);
            document.getElementById('averageRate').textContent = averageCompletion + '%';
        }

        // Animate numbers
        function animateCounter(elementId, targetValue) {
            const element = document.getElementById(elementId);
            const startValue = parseInt(element.textContent);
            const increment = targetValue > startValue ? 1 : -1;
            let currentValue = startValue;

            const timer = setInterval(() => {
                currentValue += increment;
                element.textContent = currentValue;

                if (currentValue === targetValue) {
                    clearInterval(timer);
                }
            }, 50);
        }

        // Display data in table
        function displayData(data) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            data.forEach(pharmacist => {
                const row = tableBody.insertRow();
                
                row.innerHTML = `
                    <td><strong>${pharmacist.name}</strong></td>
                    <td>${pharmacist.city}</td>
                    <td>${pharmacist.district}</td>
                    <td>${pharmacist.supervisor}</td>
                    <td><strong>${pharmacist.course}</strong></td>
                    <td>
                        <span class="status-badge ${pharmacist.courseType === 'Mandatory' ? 'status-pending' : 'status-progress'}">
                            ${pharmacist.courseType}
                        </span>
                    </td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${pharmacist.completion}%"></div>
                        </div>
                        <small><strong>${pharmacist.completion}%</strong></small>
                    </td>
                    <td>
                        <span class="status-badge status-${pharmacist.status === 'Completed' ? 'completed' : pharmacist.status === 'In Progress' ? 'progress' : 'pending'}">
                            ${pharmacist.status}
                        </span>
                    </td>
                    <td>${pharmacist.dateCompleted}</td>
                `;
            });
        }

        // Setup Multi-Select
        function setupMultiSelect(containerId, dropdownId, selectedId, options, selectedArray, triggerId) {
            const container = document.getElementById(containerId);
            const dropdown = document.getElementById(dropdownId);
            const selectedContainer = document.getElementById(selectedId);
            const trigger = document.getElementById(triggerId);

            if (!container || !dropdown || !selectedContainer || !trigger) {
                console.error('Multi-select elements not found:', containerId);
                return;
            }

            // Create options
            dropdown.innerHTML = '';
            options.forEach(option => {
                const div = document.createElement('div');
                div.className = 'multi-select-option';
                const checkboxId = `${containerId}_${option.replace(/\s+/g, '_').replace(/\./g, '_')}`;
                div.innerHTML = `
                    <input type="checkbox" id="${checkboxId}" value="${option}">
                    <label for="${checkboxId}">${option}</label>
                `;
                dropdown.appendChild(div);
            });

            // Open/close dropdown - Fix the click event
            trigger.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                // Close all other dropdowns first
                document.querySelectorAll('.multi-select-dropdown').forEach(dd => {
                    if (dd !== dropdown) {
                        dd.classList.remove('show');
                    }
                });
                
                // Toggle current dropdown
                dropdown.classList.toggle('show');
            });

            // Handle checkbox changes
            dropdown.addEventListener('change', (e) => {
                e.stopPropagation();
                if (e.target.type === 'checkbox') {
                    const value = e.target.value;
                    if (e.target.checked) {
                        if (!selectedArray.includes(value)) {
                            selectedArray.push(value);
                        }
                    } else {
                        const index = selectedArray.indexOf(value);
                        if (index > -1) {
                            selectedArray.splice(index, 1);
                        }
                    }
                    updateSelectedItems(selectedContainer, selectedArray, containerId);
                    applyFilters();
                }
            });

            // Prevent dropdown from closing when clicking inside
            dropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!container.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });
        }

        // Update selected items display
        function updateSelectedItems(container, selectedArray, containerId) {
            container.innerHTML = '';
            selectedArray.forEach(item => {
                const span = document.createElement('span');
                span.className = 'selected-item';
                span.innerHTML = `
                    ${item}
                    <span class="remove-item" data-value="${item}" data-container="${containerId}">×</span>
                `;
                container.appendChild(span);
            });

            // Handle item removal
            container.querySelectorAll('.remove-item').forEach(removeBtn => {
                removeBtn.addEventListener('click', (e) => {
                    const value = e.target.getAttribute('data-value');
                    const containerId = e.target.getAttribute('data-container');
                    const index = selectedArray.indexOf(value);
                    
                    if (index > -1) {
                        selectedArray.splice(index, 1);
                        updateSelectedItems(container, selectedArray, containerId);
                        
                        // Uncheck the checkbox
                        const checkboxId = `${containerId}_${value.replace(/\s+/g, '_').replace(/\./g, '_')}`;
                        const checkbox = document.getElementById(checkboxId);
                        if (checkbox) checkbox.checked = false;
                        
                        applyFilters();
                    }
                });
            });
        }

        // Apply filters
        function applyFilters() {
            const searchTerm = document.getElementById('pharmacistSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const courseTypeFilter = document.getElementById('courseTypeFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;

            filteredData = pharmacistsData.filter(pharmacist => {
                const matchesSearch = pharmacist.name.toLowerCase().includes(searchTerm);
                const matchesStatus = statusFilter === '' || pharmacist.status === statusFilter;
                const matchesCourseType = courseTypeFilter === '' || pharmacist.courseType === courseTypeFilter;
                const matchesCity = selectedCities.length === 0 || selectedCities.includes(pharmacist.city);
                const matchesSupervisor = selectedSupervisors.length === 0 || selectedSupervisors.includes(pharmacist.supervisor);
                const matchesDistrict = selectedDistricts.length === 0 || selectedDistricts.includes(pharmacist.district);
                const matchesCourse = selectedCourses.length === 0 || selectedCourses.includes(pharmacist.course);
                
                let matchesDate = true;
                if (dateFrom || dateTo) {
                    const pharmacistDate = new Date(pharmacist.dateCompleted);
                    if (dateFrom && pharmacistDate < new Date(dateFrom)) matchesDate = false;
                    if (dateTo && pharmacistDate > new Date(dateTo)) matchesDate = false;
                }

                return matchesSearch && matchesStatus && matchesCourseType && matchesCity && 
                       matchesSupervisor && matchesDistrict && matchesCourse && matchesDate;
            });

            displayData(filteredData);
            updateStats();
            updateAllCharts();
        }

        // Create performance trend chart
        function createPerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            const dates = [];
            const completionRates = [];
            
            for (let i = 30; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('en-US'));
                
                const dayData = filteredData.filter(p => {
                    const pDate = new Date(p.dateCompleted);
                    return Math.abs(pDate - date) < 24 * 60 * 60 * 1000;
                });
                
                const avgCompletion = dayData.length > 0 
                    ? dayData.reduce((sum, p) => sum + p.completion, 0) / dayData.length
                    : Math.random() * 20 + 60;
                    
                completionRates.push(Math.round(avgCompletion));
            }

            if (charts.performanceChart) {
                charts.performanceChart.destroy();
            }

            charts.performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Daily Completion Rate (%)',
                        data: completionRates,
                        borderColor: '#0066cc',
                        backgroundColor: 'rgba(0, 102, 204, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Segoe UI'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create cities comparison chart
        function createCitiesChart() {
            const ctx = document.getElementById('citiesChart').getContext('2d');
            
            const cityStats = {};
            const citiesToShow = selectedCities.length > 0 ? selectedCities : [...new Set(filteredData.map(p => p.city))];
            
            citiesToShow.forEach(city => {
                const cityData = filteredData.filter(p => p.city === city);
                if (cityData.length > 0) {
                    cityStats[city] = {
                        average: Math.round(cityData.reduce((sum, p) => sum + p.completion, 0) / cityData.length),
                        count: cityData.length,
                        completed: cityData.filter(p => p.status === 'Completed').length
                    };
                }
            });

            const labels = Object.keys(cityStats);
            const averages = labels.map(city => cityStats[city].average);

            if (charts.citiesChart) {
                charts.citiesChart.destroy();
            }

            charts.citiesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Completion Rate (%)',
                        data: averages,
                        backgroundColor: 'rgba(0, 102, 204, 0.8)',
                        borderColor: 'rgba(0, 102, 204, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: { family: 'Segoe UI' }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const city = context.label;
                                    const stats = cityStats[city];
                                    return [
                                        `Total Pharmacists: ${stats.count}`,
                                        `Completed: ${stats.completed}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Completion Rate (%)'
                            }
                        }
                    }
                }
            });
        }

        // Create supervisors comparison chart
        function createSupervisorsChart() {
            const ctx = document.getElementById('supervisorsChart').getContext('2d');
            
            const supervisorStats = {};
            const supervisorsToShow = selectedSupervisors.length > 0 ? selectedSupervisors : [...new Set(filteredData.map(p => p.supervisor))];
            
            supervisorsToShow.forEach(supervisor => {
                const supervisorData = filteredData.filter(p => p.supervisor === supervisor);
                if (supervisorData.length > 0) {
                    supervisorStats[supervisor] = {
                        average: Math.round(supervisorData.reduce((sum, p) => sum + p.completion, 0) / supervisorData.length),
                        count: supervisorData.length,
                        completed: supervisorData.filter(p => p.status === 'Completed').length
                    };
                }
            });

            const labels = Object.keys(supervisorStats);
            const averages = labels.map(supervisor => supervisorStats[supervisor].average);

            if (charts.supervisorsChart) {
                charts.supervisorsChart.destroy();
            }

            charts.supervisorsChart = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Completion Rate (%)',
                        data: averages,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 205, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Completion Rate (%)'
                            }
                        }
                    }
                }
            });
        }

        // Create districts comparison chart
        function createDistrictsChart() {
            const ctx = document.getElementById('districtsChart').getContext('2d');
            
            const districtStats = {};
            const districtsToShow = selectedDistricts.length > 0 ? selectedDistricts : [...new Set(filteredData.map(p => p.district))];
            
            districtsToShow.forEach(district => {
                const districtData = filteredData.filter(p => p.district === district);
                if (districtData.length > 0) {
                    districtStats[district] = {
                        average: Math.round(districtData.reduce((sum, p) => sum + p.completion, 0) / districtData.length),
                        count: districtData.length
                    };
                }
            });

            const labels = Object.keys(districtStats);
            const averages = labels.map(district => districtStats[district].average);

            if (charts.districtsChart) {
                charts.districtsChart.destroy();
            }

            charts.districtsChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completion Rate (%)',
                        data: averages,
                        backgroundColor: 'rgba(0, 102, 204, 0.2)',
                        borderColor: 'rgba(0, 102, 204, 1)',
                        pointBackgroundColor: 'rgba(0, 102, 204, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(0, 102, 204, 1)',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: { family: 'Segoe UI' }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create courses comparison chart
        function createCoursesChart() {
            const ctx = document.getElementById('coursesChart').getContext('2d');
            
            const courseStats = {};
            const coursesToShow = selectedCourses.length > 0 ? selectedCourses : [...new Set(filteredData.map(p => p.course))];
            
            coursesToShow.forEach(course => {
                const courseData = filteredData.filter(p => p.course === course);
                if (courseData.length > 0) {
                    courseStats[course] = {
                        average: Math.round(courseData.reduce((sum, p) => sum + p.completion, 0) / courseData.length),
                        count: courseData.length,
                        completed: courseData.filter(p => p.status === 'Completed').length
                    };
                }
            });

            const labels = Object.keys(courseStats);
            const averages = labels.map(course => courseStats[course].average);

            if (charts.coursesChart) {
                charts.coursesChart.destroy();
            }

            charts.coursesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Completion Rate (%)',
                        data: averages,
                        backgroundColor: labels.map((course, index) => {
                            const colors = [
                                'rgba(54, 162, 235, 0.8)',
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(75, 192, 192, 0.8)',
                                'rgba(153, 102, 255, 0.8)',
                                'rgba(255, 159, 64, 0.8)',
                                'rgba(255, 205, 86, 0.8)'
                            ];
                            return colors[index % colors.length];
                        }),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Completion Rate (%)'
                            }
                        }
                    }
                }
            });
        }

        // Create course types chart
        function createCourseTypesChart() {
            const ctx = document.getElementById('courseTypesChart').getContext('2d');
            
            const mandatoryData = filteredData.filter(p => p.courseType === 'Mandatory');
            const optionalData = filteredData.filter(p => p.courseType === 'Optional');

            const mandatoryAvg = mandatoryData.length > 0 ? 
                Math.round(mandatoryData.reduce((sum, p) => sum + p.completion, 0) / mandatoryData.length) : 0;
            const optionalAvg = optionalData.length > 0 ? 
                Math.round(optionalData.reduce((sum, p) => sum + p.completion, 0) / optionalData.length) : 0;

            if (charts.courseTypesChart) {
                charts.courseTypesChart.destroy();
            }

            charts.courseTypesChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Mandatory Courses', 'Optional Courses'],
                    datasets: [{
                        label: 'Average Completion Rate',
                        data: [mandatoryAvg, optionalAvg],
                        backgroundColor: [
                            'rgba(220, 53, 69, 0.8)',
                            'rgba(40, 167, 69, 0.8)'
                        ],
                        borderColor: [
                            'rgba(220, 53, 69, 1)',
                            'rgba(40, 167, 69, 1)'
                        ],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Create top pharmacists chart
        function createPharmacistsChart() {
            const ctx = document.getElementById('pharmacistsChart').getContext('2d');
            
            const sortedPharmacists = filteredData
                .sort((a, b) => b.completion - a.completion)
                .slice(0, 10);

            const labels = sortedPharmacists.map(p => p.name.split(' ').slice(0, 2).join(' '));
            const completions = sortedPharmacists.map(p => p.completion);

            if (charts.pharmacistsChart) {
                charts.pharmacistsChart.destroy();
            }

            charts.pharmacistsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completion Rate (%)',
                        data: completions,
                        backgroundColor: 'rgba(40, 167, 69, 0.8)',
                        borderColor: 'rgba(40, 167, 69, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Completion Rate (%)'
                            }
                        }
                    }
                }
            });
        }

        // Create status pie chart
        function createStatusPieChart() {
            const ctx = document.getElementById('statusPieChart').getContext('2d');
            
            const completed = filteredData.filter(p => p.status === 'Completed').length;
            const progress = filteredData.filter(p => p.status === 'In Progress').length;
            const pending = filteredData.filter(p => p.status === 'Pending').length;

            if (charts.statusPieChart) {
                charts.statusPieChart.destroy();
            }

            charts.statusPieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'In Progress', 'Pending'],
                    datasets: [{
                        data: [completed, progress, pending],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(220, 53, 69, 0.8)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)'
                        ],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { 
                                    family: 'Segoe UI',
                                    size: 14
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((sum, value) => sum + value, 0);
                                    const percentage = Math.round((context.parsed / total) * 100);
                                    return `${context.label}: ${context.parsed} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update all charts
        function updateAllCharts() {
            createPerformanceChart();
            createCitiesChart();
            createSupervisorsChart();
            createDistrictsChart();
            createCoursesChart();
            createCourseTypesChart();
            createPharmacistsChart();
            createStatusPieChart();
        }

        // Clear all filters
        function clearAllFilters() {
            // Clear text inputs
            document.getElementById('pharmacistSearch').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            
            // Clear select dropdowns
            document.getElementById('statusFilter').value = '';
            document.getElementById('courseTypeFilter').value = '';
            
            // Clear multi-select arrays
            selectedCities.length = 0;
            selectedSupervisors.length = 0;
            selectedDistricts.length = 0;
            selectedCourses.length = 0;
            
            // Clear selected items display
            const selectedCitiesContainer = document.getElementById('selectedCities');
            const selectedSupervisorsContainer = document.getElementById('selectedSupervisors');
            const selectedDistrictsContainer = document.getElementById('selectedDistricts');
            const selectedCoursesContainer = document.getElementById('selectedCourses');
            
            if (selectedCitiesContainer) selectedCitiesContainer.innerHTML = '';
            if (selectedSupervisorsContainer) selectedSupervisorsContainer.innerHTML = '';
            if (selectedDistrictsContainer) selectedDistrictsContainer.innerHTML = '';
            if (selectedCoursesContainer) selectedCoursesContainer.innerHTML = '';
            
            // Uncheck all checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            
            // Close all dropdowns
            document.querySelectorAll('.multi-select-dropdown').forEach(dd => {
                dd.classList.remove('show');
            });
            
            // Reapply filters (which will show all data since filters are cleared)
            applyFilters();
        }

        // Initialize filters
        function initializeFilters() {
            const cities = [...new Set(pharmacistsData.map(p => p.city))];
            const supervisors = [...new Set(pharmacistsData.map(p => p.supervisor))];
            const districts = [...new Set(pharmacistsData.map(p => p.district))];
            const courses = [...new Set(pharmacistsData.map(p => p.course))];
            
            setupMultiSelect('cityMultiSelect', 'cityDropdown', 'selectedCities', cities, selectedCities, 'cityTrigger');
            setupMultiSelect('supervisorMultiSelect', 'supervisorDropdown', 'selectedSupervisors', supervisors, selectedSupervisors, 'supervisorTrigger');
            setupMultiSelect('districtMultiSelect', 'districtDropdown', 'selectedDistricts', districts, selectedDistricts, 'districtTrigger');
            setupMultiSelect('courseMultiSelect', 'courseDropdown', 'selectedCourses', courses, selectedCourses, 'courseTrigger');
        }

        // Toggle table visibility
        function toggleTable() {
            const tableSection = document.getElementById('tableSection');
            const toggleBtn = document.getElementById('toggleTableBtn');
            
            if (tableSection.style.display === 'none') {
                tableSection.style.display = 'block';
                toggleBtn.textContent = 'Hide Table';
                toggleBtn.classList.remove('btn-secondary');
                toggleBtn.classList.add('btn-primary');
            } else {
                tableSection.style.display = 'none';
                toggleBtn.textContent = 'Show Table';
                toggleBtn.classList.remove('btn-primary');
                toggleBtn.classList.add('btn-secondary');
            }
        }

        // Load data simulation
        function loadData() {
            setTimeout(() => {
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('dataTable').style.display = 'table';
                
                displayData(pharmacistsData);
                updateStats();
                initializeFilters();
                updateAllCharts();
            }, 2000);
        }

        // Event listeners
        document.getElementById('pharmacistSearch').addEventListener('input', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('courseTypeFilter').addEventListener('change', applyFilters);
        document.getElementById('dateFrom').addEventListener('change', applyFilters);
        document.getElementById('dateTo').addEventListener('change', applyFilters);
        document.getElementById('clearFilters').addEventListener('click', clearAllFilters);
        document.getElementById('toggleTableBtn').addEventListener('click', toggleTable);

        // Initialize the application
        loadData();
// Fix: make sure multi-select filters apply correctly
document.querySelectorAll('.multi-select-dropdown input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', applyFilters);
});

